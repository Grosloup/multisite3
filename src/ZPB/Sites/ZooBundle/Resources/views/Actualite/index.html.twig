{% extends "ZPBSitesZooBundle:Layouts:master.html.twig" %}
{% block title %}Actualités{% endblock %}

{% set active_page = "news" %}

{% block content %}

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="page-header">
                    <h1>Actualité</h1>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="posts">
                    <div class="row">
                    {% for pub in pubs %}
                        <div class="post-col">
                            <div class="post">
                                <header>
                                    <div class="post-category"><a href="{{ path("zpb_sites_zoo_actualites_list_by_category", {slug: pub.category.slug}) }}">{{ pub.category.name }}</a></div>
                                    <h1 class="post-title"><a href="{{ path("zpb_sites_zoo_actualites_single", {slug: pub.post.slug}) }}">{{ pub.post.title }}</a></h1>
                                    <div class="post-date">{{ pub.publishedAt|date("d/m/y") }}</div>
                                </header>
                                <article>

                                        <div class="post-thumbnail">
                                            {% if pub.post.squarreThumb != null %}
                                            <img src="{{ post_squarre_img_url(pub.post.squarreThumb) }}" alt=""/>
                                            {% else %}
                                            <img src="{{ post_squarre_img_def_url() }}" alt=""/>
                                            {% endif %}
                                        </div>

                                        <div class="post-excerpt">
                                            <p>{{ pub.post.excerpt }}</p>
                                            <div class="post-more"><a href="">Lire plus...</a></div>
                                        </div>

                                </article>
                                <footer>
                                    {% if pub.tags|length > 0 %}
                                        <div class="post-tags">
                                            <ul>
                                                {% for tag in pub.tags %}
                                                    <li><a href="{{ path("zpb_sites_zoo_actualites_list_by_tag", {slug: tag.slug}) }}">{{ tag.name }}</a>{% if loop.last != true %}, {% endif %}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}
                                </footer>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                </div>
            </div>
            {#<div class="col-md-1">
                {{ render(controller("ZPBSitesZooBundle:Actualite:listCategories")) }}
                {{ render(controller("ZPBSitesZooBundle:Actualite:listTags")) }}
            </div>#}
        </div>

    </div>
{% endblock %}

{% block footScripts %}
    {{ parent() }}
    {#<script>
        (function($,w){
            function ExcerptShortener(el, options){
                this.options = $.extend({}, excerptShortenerDefaults, options || {});
                this.$el = $(el);
                this.chars = [];
                this.init();
            }

            ExcerptShortener.prototype.init = function(){
                this.originalText = this.$el.text();
                this.finalText = this.$el.text();
                if(this.originalText.length > this.options.maxLength){
                    this.reduce();
                }
            };

            ExcerptShortener.prototype.reduce = function(){
                this.finalText =
                        "<p>"
                        + this.originalText.substr(0, this.options.maxLength)
                        + "<span class='excerpt-more'>" + this.options.replacementText + "</span>"
                        +"</p>";
                this.$el.hide();
                this.$el.before(this.finalText);
            };

            var excerptShortenerDefaults = {
                maxLength: 200,
                replacementText: " ... "
            };

            $.fn.excerptShortener = function(options){

                return this.each(function(){

                    if(!$.data(this, "excerptShortener")){
                        $.data(this, "excerptShortener", new ExcerptShortener(this, options));
                    }
                });
            };

        })(jQuery, this);
    </script>
    <script>
        $(function(){

            var excerpts = $(".post-excerpt > p");
            excerpts.excerptShortener();

        });
    </script>#}
{% endblock %}
