!function(a){function b(b,d){this.$el=a(b),this.options=a.extend({},c,d||{}),this.init()}var c={hover:"hover",progressBar:".dropzone-innerbar",url:null,maxSize:1e6,allow:["image/jpeg","image/gif","image/png"],errorMessage:function(){},loadDone:function(){},loadFail:function(){}};b.prototype.init=function(){var a=this.$el,b=this;this.isDroppable=!0,this.progressBar=a.find(this.options.progressBar),a.on({dragenter:b.dragenter,dragover:b.dragover,dragleave:b.dragleave,drop:b.drop})},b.prototype.dragenter=function(a){a.preventDefault()},b.prototype.dragover=function(b){b.preventDefault();var c=a(this).data("zpbUploadImage");a(this).addClass(c.options.hover)},b.prototype.dragleave=function(b){b.preventDefault();var c=a(this).data("zpbUploadImage");a(this).removeClass(c.options.hover)},b.prototype.drop=function(b){b.preventDefault();var c=a(this).data("zpbUploadImage");a(this).removeClass(c.options.hover),c.options.errorMessage(""),c.isDroppable===!0&&(c.isDroppable=!1,c.upload(b.dataTransfer.files))},b.prototype.upload=function(b){function c(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100)+"%";e.progressBar.width(b)}}var d=b[0],e=this;return!1 in d?(this.options.errorMessage(""),this.options.errorMessage("L'élément déposé n'est pas un fichier"),!1):this.options.allow.indexOf(d.type)<0?(this.options.errorMessage(""),this.options.errorMessage("L'élément déposé n'est pas du bon type "+d.type),!1):d.size>this.options.maxSize?(this.options.errorMessage(""),this.options.errorMessage("L'élément déposé est trop lourd"),!1):(this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",c,!1),this.xhr.open("post",this.options.url,!0),this.xhr.onreadystatechange=function(b){if(4==e.xhr.readyState)if(e.isDroppable=!0,200==e.xhr.status){var c=a.parseJSON(b.target.responseText);c.error?e.options.loadFail(c):e.options.loadDone(c)}else e.options.errorMessage(""),e.options.errorMessage(e.xhr.status+" "+e.xhr.statusText)},this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xhr.setRequestHeader("Content-Type","multipart/form-data"),this.xhr.setRequestHeader("X-File-Name",d.name),this.xhr.setRequestHeader("X-File-Type",d.type),this.xhr.setRequestHeader("X-File-Size",d.size),void this.xhr.send(d))},a.fn.zpbUploadImage=function(c){return c.url?this.each(function(){a.data(this,"zpbUploadImage")||a.data(this,"zpbUploadImage",new b(this,c))}):void console.error("url non définie !")}}(jQuery,this);