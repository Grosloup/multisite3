!function(a){jQuery.event.props.push("dataTransfer"),a.fn.animalImageUploader=function(b){function c(b,c,d,e){function f(b){var d=a.parseJSON(b.target.responseText);i.text(d.msg),k.width("0%"),c.data("droppable",!0),d.error||(j=e.template.replace(/__url__/,d.url),j=j.replace(/__id__/g,d.id),j=j.replace(/__href__/,d.href),l.append(a(j)))}function g(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100)+"%";k.width(b)}}var h=b[d],i=c.find(e.message);if(!1 in h)return i.text("L'élément déposé n'est pas un fichier"),!1;if(h.size>e.maxSize)return i.text("L'élément déposé est trop lourd"),!1;if(e.allow.indexOf(h.type)<0)return i.text("L'élément déposé n'est pas du bon type"),!1;var j,k=(c.find(e.droparea),c.find(e.progressbar)),l=a(e.target),m=new XMLHttpRequest;m.addEventListener("load",f,!1),m.upload.addEventListener("progress",g,!1),m.open("post",e.url,!0),m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.setRequestHeader("Content-Type","multipart/form-data"),m.setRequestHeader("X-File-Name",h.name),m.setRequestHeader("X-File-Type",h.type),m.setRequestHeader("X-File-Size",h.size),m.setRequestHeader("X-File-AnimalId",c.data("id")),m.send(h)}var d={url:"/uploads",type:"hd",target:null,element:null,droparea:".dropzone-in",droploader:".dropzone-loader",progressbar:".dropzone-innerbar",hover:"hover",legend:"Déposez votre image ici",allow:["image/jpeg"],maxSize:6e6,message:".dropzone-message"},e=a.extend({},d,b||{});this.each(function(){var b=a(this),d=b.find(".dropzone-legend");d.text(e.legend);{var f=(b.find(e.progressbar),b.find(e.message));b.find(e.droparea)}d.text(e.legend),b.data("droppable",!0),b.on({dragenter:function(a){a.preventDefault()},dragover:function(b){b.preventDefault(),a(this).addClass(e.hover)},dragleave:function(b){b.preventDefault(),a(this).removeClass(e.hover)},drop:function(d){d.preventDefault(),a(this).removeClass(e.hover),f.text(),b.data("droppable")&&c(d.dataTransfer.files,b,0,e)}})})}}(jQuery,this,document),$(function(){var a=$("#hd-drop"),b=$("#wallpaper-drop"),c=$("#front-drop");a.animalImageUploader({url:"/parrainages/xhr/animal/ajouter/hd-images",type:"hd",target:"#hd-list",template:"<div class='column-2' id='img-hd-__id__'><div><img src='__url__' width='100%'/><div><a class='btn btn-flat delete-hd' href='__href__' data-target='img-hd-__id__'><i class='fa fa-trash-o'></i></a></div></div></div>"}),b.animalImageUploader({url:"/parrainages/xhr/animal/ajouter/wallpaper-images",type:"wallpaper",target:"#wp-list",template:"<div class='column-2' id='img-wp-__id__'><div><img src='__url__' width='100%'/><div><a class='btn btn-flat delete-wp' href='__href__' data-target='img-wp-__id__'><i class='fa fa-trash-o'></i></a></div></div></div>"}),c.animalImageUploader({url:"/parrainages/xhr/animal/ajouter/front-images",type:"front",target:"#front-list",template:"<div class='column-2' id='img-front-__id__'><div><img src='__url__' width='100%'/><div><a class='btn btn-flat delete-front' href='__href__' data-target='img-front-__id__'><i class='fa fa-trash-o'></i></a></div></div></div>"}),$(document).on("click","a.delete-hd",function(a){a.preventDefault();var b=$("#"+$(this).data("target")),c=$("<span class='loader'></span>"),d=$(this);$(this).after(c),$(this).hide(),$.get($(this).attr("href")).done(function(a){a.error||b.remove()}).fail(function(){d.show(),c.remove()})}),$(document).on("click","a.delete-front",function(a){a.preventDefault();var b=$("#"+$(this).data("target")),c=$("<span class='loader'></span>"),d=$(this);$(this).after(c),$(this).hide(),$.get($(this).attr("href")).done(function(a){a.error||b.remove()}).fail(function(){d.show(),c.remove()})}),$(document).on("click","a.delete-wp",function(a){a.preventDefault();var b=$("#"+$(this).data("target")),c=$("<span class='loader'></span>"),d=$(this);$(this).after(c),$(this).hide(),$.get($(this).attr("href")).done(function(a){a.error||b.remove()}).fail(function(){d.show(),c.remove()})})});