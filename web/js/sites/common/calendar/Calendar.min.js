define(["require","exports","jquery","Event","Day"],function(a,b,c,d,e){var f=function(){function a(b,d,e,f){this.element=b,this.mediator=d,this.evtManager=e,this.isLocked=!0,this.options={},this.options=c.extend(!0,{},a.DEFAULTS,f||{}),this.mediator.set(this.options.mediatorName,this),this.init()}return a.prototype.init=function(){this.today=new Date,this.curYear=this.today.getFullYear(),this.curMonth=this.today.getMonth(),this.curDate=this.today.getDate(),this.$view=c("<div/>",{"class":this.options.elemDefaultClass}),this.build(),this.attachEvents(),this.initMouseEvents()},a.prototype.build=function(){this.buildHeader(),this.body=c("<div/>",{"class":this.getClass("bodyClass")}),this.$view.append(this.body),this.buildBaseLayer(),this.evtLayer=c("<div/>",{"class":this.getClass("evtLayerClass")}),this.$view.append(this.evtLayer),this.buildEventLayer(),this.element.append(this.$view),this.unlock(),this.evtManager.trigger(new d.Event("c:state:ready",{day:this.curDate,month:this.curMonth,year:this.curYear,target:this}))},a.prototype.buildHeader=function(){this.header=c("<div/>",{"class":this.getClass("headerClass")}),this.monthSelector=this.mediator.getMonthSelector(),this.loader=this.mediator.getLoader(),this.headerRow=c("<div/>",{"class":this.getClass(this.options.headerRowClass)}),this.headerRow.append(this.monthSelector.getElement()),this.header.append(this.headerRow),this.$view.append(this.header)},a.prototype.buildBaseLayer=function(){var a,b,c,d,e,f;a=new Date(this.curYear,this.curMonth,1),b=this.getRealDay(a),c=this.getNumDaysInMonth(this.curYear,this.curMonth),d=new Date(this.curYear,this.curMonth,c),e=2+(c-(this.getNumDaysFirstWeek(b)+this.getRealDay(d)))/7,f=this.getClass("")+e,this.$view.removeClass(this.getClass("")+"4 "+this.getClass("")+"5 "+this.getClass("")+"6"),this.$view.addClass(f),this.emptyBody();for(var g=0,h=0,i=1,j=1;e>g;g++){var k=this.createBodyRow();for(h=0;7>h;h++){var l=this.createBodyCell();if(i>=b&&c+b>i){var m=this.createBodyDay(j+"");l.append(m),l.attr("data-cellindex",(j-1).toString()),this.curYear==this.today.getFullYear()&&this.curMonth==this.today.getMonth()&&j==this.today.getDate()&&l.addClass(this.getClass("calCellTodayClass")),j++}else l.addClass(this.getClass("emptyCellClass"));i++,k.append(l)}this.body.append(k)}},a.prototype.buildEventLayer=function(){var a,b,c,d,f;a=new Date(this.curYear,this.curMonth,1),b=this.getRealDay(a),c=this.getNumDaysInMonth(this.curYear,this.curMonth),d=new Date(this.curYear,this.curMonth,c),f=2+(c-(this.getNumDaysFirstWeek(b)+this.getRealDay(d)))/7,this.emptyEventLayer();for(var g=0,h=0,i=1,j=1;f>g;g++){var k=this.createEvtLayerRow();for(h=0;7>h;h++){var l;if(i>=b&&c+b>i){l=this.createEvtLayerCell(!0),l.attr("data-cellindex",j-1),l.attr("data-celldate",this.curYear+"/"+(this.curMonth+1)+"/"+j);var m=new e.Day(j-1,j,this.curMonth,this.curYear,this.evtManager);l.data={day:m},j++}else l=this.createEvtLayerCell(!1);i++,k.append(l)}this.evtLayer.append(k)}},a.prototype.attachEvents=function(){this.evtManager.addEvent("ms:month:up",this.changeMonth,this),this.evtManager.addEvent("ms:month:down",this.changeMonth,this)},a.prototype.changeMonth=function(a){this.curMonth=a.month,this.curYear=a.year,this.refresh()},a.prototype.dispatchDatas=function(){},a.prototype.showError=function(){},a.prototype.initMouseEvents=function(){var a;a=this,c(document).on("click","[data-cell]",function(b){if(b.preventDefault(),a.isLocked)return!1;var e=c(this),f={index:e.attr("cellindex"),date:e.attr("celldate"),day:this.data.day.daynum,month:this.data.day.month,year:this.data.day.year,target:a};a.evtManager.trigger(new d.Event("c:day:click",f))})},a.prototype.lock=function(){this.isLocked=!0,this.monthSelector.lock()},a.prototype.unlock=function(){this.isLocked=!1,this.monthSelector.unlock()},a.prototype.refresh=function(){this.lock(),this.emptyBody(),this.emptyEventLayer(),this.buildBaseLayer(),this.buildEventLayer(),this.unlock()},a.prototype.emptyBody=function(){this.body.empty()},a.prototype.emptyEventLayer=function(){this.evtLayer.empty()},a.prototype.getMonthName=function(a){this.monthSelector.getMonthName(a||this.curMonth)},a.prototype.createBodyRow=function(){return c("<div/>",{"class":this.getClass("bodyRowClass")})},a.prototype.createBodyCell=function(){return c("<div/>",{"class":this.getClass("bodyCellClass")})},a.prototype.createBodyDay=function(a){return c("<div/>",{"class":this.getClass("bodyDayClass"),text:a})},a.prototype.createEvtLayerRow=function(){return c("<div/>",{"class":this.getClass("evtLayerRowClass")})},a.prototype.createEvtLayerCell=function(a){var b=c("<div/>",{"class":this.getClass("evtLayerCellClass")});return void 0!=a&&a===!0?(b.addClass(this.getClass("evtLayerCellEnabledClass")),b.attr("data-cell","")):b.addClass(this.getClass("evtLayerCellDisabledClass")),b},a.prototype.getClass=function(a){var b=this.options.classPrefix||"",c=this.options[a]||"";return b+c},a.prototype.getNumDaysInMonth=function(a,b){return new Date(b,a+1,0).getDate()},a.prototype.getRealDay=function(a){var b=a.getDay();return 0===b&&(b=7),b},a.prototype.getNumDaysFirstWeek=function(a){return 8-a},a.DEFAULTS={mediatorName:"calendar",elemDefaultClass:"calendar",classPrefix:"cal-",loaderClassName:"loader",days:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],headerClass:"header",headerRowClass:"header-row",headerDayRowClass:"header-row-day",headerDayCellClass:"header-cell-day",headerDayCellTemplate:"<span class='show-only-md'>[[longday]]</span><span class='hide-only-md'>[[shortday]]</span>",bodyClass:"body",bodyRowClass:"body-row",bodyCellClass:"body-cell",bodyDayClass:"body-day",calCellTodayClass:"cell-today",emptyCellClass:"empty-cell",evtLayerClass:"event-layer",evtLayerRowClass:"event-layer-row",evtLayerCellClass:"event-layer-cell",evtLayerCellEnabledClass:"cell-enabled",evtLayerCellDisabledClass:"cell-disabled"},a}();b.Calendar=f});